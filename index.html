<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Сложение — настраиваемое A (A+1…A+9)</title>
  <style>
    :root{
      --bg:#f7fafc;--card:#fff;--text:#111827;--muted:#6b7280;
      --ok:#16a34a;--bad:#dc2626;--focus:#2563eb;--accent:#f59e0b
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial,"Apple Color Emoji","Segoe UI Emoji";background:var(--bg);color:var(--text)}
    .wrap{max-width:960px;margin:0 auto;padding:24px 16px 48px}
    header{display:flex;align-items:center;gap:12px;margin-bottom:8px}
    .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#fb923c);display:grid;place-items:center;color:#fff;font-weight:800;font-size:22px;box-shadow:0 6px 18px rgba(0,0,0,.08);user-select:none}
    h1{font-size:28px;margin:0}
    .subtitle{color:var(--muted);margin:6px 0 18px}

    .controls{display:flex;flex-wrap:wrap;gap:12px;align-items:center;margin:10px 0 6px}
    label{font-weight:700}
    select{padding:8px 10px;border:2px solid #e5e7eb;border-radius:10px;font-size:16px;outline:none}
    select:focus{border-color:var(--focus);box-shadow:0 0 0 4px rgba(37,99,235,.12)}

    .modes{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0 14px}
    .seg{border:none;border-radius:12px;padding:10px 14px;font-size:15px;cursor:pointer;font-weight:700;background:#111827;color:#fff;opacity:.65;transition:opacity .2s,transform .05s}
    .seg:hover{opacity:.85;transform:translateY(-1px)}
    .seg.active{opacity:1;box-shadow:0 6px 18px rgba(0,0,0,.16)}
    .seg.rand{background:var(--accent);color:#111}

    .toolbar{display:flex;flex-wrap:wrap;gap:10px;margin:12px 0 22px}
    button{border:none;border-radius:12px;padding:12px 16px;font-size:16px;cursor:pointer;font-weight:600;background:#111827;color:#fff;box-shadow:0 4px 12px rgba(0,0,0,.12);transition:transform .05s,box-shadow .2s,opacity .2s}
    button:hover{transform:translateY(-1px);box-shadow:0 8px 20px rgba(0,0,0,.18)}
    button:active{transform:translateY(0)}
    .btn-alt{background:#374151}
    .btn-show{background:var(--accent);color:#111}

    .grid{display:grid;gap:14px;grid-template-columns:repeat(auto-fill,minmax(210px,1fr))}
    .card{background:var(--card);border-radius:16px;padding:16px;box-shadow:0 6px 18px rgba(0,0,0,.06);transition:box-shadow .2s,transform .1s}
    .card:focus-within{box-shadow:0 10px 26px rgba(37,99,235,.18)}
    .expr{font-size:22px;font-weight:700;margin-bottom:10px}
    .row{display:grid;grid-template-columns:1fr 64px;gap:10px;align-items:center}
    input[type="number"]{width:100%;font-size:20px;padding:10px 12px;border-radius:12px;border:2px solid #e5e7eb;outline:none;transition:border-color .2s,box-shadow .2s;-moz-appearance:textfield}
    input[type="number"]:focus{border-color:var(--focus);box-shadow:0 0 0 4px rgba(37,99,235,.12)}
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}
    .status{text-align:center;font-weight:800;font-size:18px}
    .ok{color:var(--ok)}
    .bad{color:var(--bad)}
    .hint{color:var(--muted);font-size:12px;margin-top:6px}
    .shake{animation:shake .25s}
    @keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-3px)}75%{transform:translateX(3px)}}
    footer{margin-top:28px;color:var(--muted);font-size:14px}

    .rand-box{background:var(--card);border-radius:16px;padding:18px;box-shadow:0 6px 18px rgba(0,0,0,.06)}
    .rand-row{display:grid;grid-template-columns:1fr 100px;gap:10px;align-items:center}
    .muted{color:var(--muted)}
    .hidden{display:none}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">A+</div>
      <div>
        <h1>Сложение с настраиваемым первым числом</h1>
        <div class="subtitle">Выбери A (1–9). Режимы: «Все примеры» (A+1…A+9) и «Рандом» (A + случайное).</div>
      </div>
    </header>

    <!-- НАСТРОЙКИ -->
    <div class="controls">
      <label for="baseA">Первое число (A):</label>
      <select id="baseA" aria-label="Выбор первого числа">
        <!-- заполним из JS -->
      </select>
    </div>

    <!-- Переключатель режимов -->
    <div class="modes">
      <button class="seg active" id="modeAllBtn">Режим: все примеры</button>
      <button class="seg rand" id="modeRandBtn">Режим: рандом</button>
    </div>

    <!-- Панель для "все примеры" -->
    <div class="toolbar" id="toolbarAll">
      <button id="checkAll">Проверить всё</button>
      <button id="clearAll" class="btn-alt">Сбросить ответы</button>
      <button id="showAll" class="btn-show">Показать ответы</button>
    </div>

    <!-- Сетка карточек -->
    <section class="grid" id="grid"></section>

    <!-- Рандомный режим -->
    <section id="randSection" class="hidden">
      <div class="rand-box" id="randBox">
        <div class="expr" id="randExpr">A + ? = ?</div>
        <div class="rand-row">
          <input id="randInput" type="number" inputmode="numeric" placeholder="Ваш ответ" aria-label="Ответ" />
          <div class="status" id="randStatus">➖</div>
        </div>
        <div class="hint">Правильный ответ: <span id="randAns" class="muted">—</span></div>

        <div class="toolbar" style="margin-top:14px">
          <button id="randCheck">Проверить</button>
          <button id="randSkip" class="btn-alt">Пропустить</button>
          <button id="randShow" class="btn-show">Показать ответ</button>
        </div>

        <div class="muted" style="margin-top:8px">
          Enter — проверка. При верном ответе новый пример появится автоматически.
        </div>
        <div class="muted" style="margin-top:6px">Решено правильно: <b id="randScore">0</b></div>
      </div>
    </section>

    <footer>
      Подсказка: в режиме «все примеры» можно нажимать <b>Tab</b> для перехода к следующему полю, <b>Enter</b> — проверка текущего.
    </footer>
  </div>

  <script>
    // ==== Состояние ====
    let A = 1;                  // выбранное первое число
    const grid = document.getElementById('grid');
    const cards = [];

    // Заполнить селект A = 1..9
    const baseASelect = document.getElementById('baseA');
    for (let i=1;i<=9;i++){
      const opt = document.createElement('option');
      opt.value = String(i);
      opt.textContent = i;
      baseASelect.appendChild(opt);
    }
    baseASelect.value = '1';

    // ==== Построение карточки ====
    function createCard(b){
      const answer = A + b;
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <div class="expr">${A} + ${b} = ?</div>
        <div class="row">
          <input type="number" inputmode="numeric" aria-label="Ответ" placeholder="Ваш ответ" data-answer="${answer}" />
          <div class="status" aria-live="polite">➖</div>
        </div>
        <div class="hint">Правильный ответ: <span class="ans" hidden>${answer}</span></div>
      `;
      return card;
    }

    // Перестроить сетку под текущее A
    function renderAllCards(){
      grid.innerHTML = '';
      cards.length = 0;
      for (let b = 1; b <= 9; b++){
        const c = createCard(b);
        grid.appendChild(c);
        cards.push(c);
      }
      // автофокус
      const first = cards[0]?.querySelector('input');
      if (first) first.focus();
    }

    // ==== Проверка карточек ====
    function checkCard(card, shakeOnFail=false){
      const input = card.querySelector('input');
      const status = card.querySelector('.status');
      const right = Number(input.dataset.answer);
      const raw = input.value.trim();
      const val = Number(raw);

      if (raw === ''){
        status.textContent = '➖';
        status.className = 'status';
        input.style.borderColor = '#e5e7eb';
        return false;
      }
      if (val === right){
        status.textContent = '✓';
        status.className = 'status ok';
        input.style.borderColor = 'var(--ok)';
        return true;
      } else {
        status.textContent = '✗';
        status.className = 'status bad';
        input.style.borderColor = 'var(--bad)';
        if (shakeOnFail){
          card.classList.remove('shake'); void card.offsetWidth; card.classList.add('shake');
        }
        return false;
      }
    }

    // Живая проверка в сетке
    grid.addEventListener('input', (e)=>{
      if (e.target.matches('input[type="number"]')){
        checkCard(e.target.closest('.card'));
      }
    });
    grid.addEventListener('keydown', (e)=>{
      if (e.key === 'Enter' && e.target.matches('input[type="number"]')){
        checkCard(e.target.closest('.card'), true);
      }
    });

    // Кнопки сетки
    document.getElementById('checkAll').addEventListener('click', ()=>{
      let allRight = true;
      for (const card of cards){
        const ok = checkCard(card, true);
        if (!ok) allRight = false;
      }
      if (allRight) alert('Молодец! Все ответы верные!');
    });

    document.getElementById('clearAll').addEventListener('click', ()=>{
      for (const card of cards){
        const input = card.querySelector('input');
        const status = card.querySelector('.status');
        input.value = '';
        input.style.borderColor = '#e5e7eb';
        status.textContent = '➖';
        status.className = 'status';
      }
      cards[0]?.querySelector('input')?.focus();
    });

    document.getElementById('showAll').addEventListener('click', ()=>{
      for (const card of cards){
        card.querySelector('.ans').hidden = false;
      }
    });

    // Автопостроение при загрузке
    window.addEventListener('DOMContentLoaded', renderAllCards);

    // ==== Режим "Рандом" ====
    const randSection = document.getElementById('randSection');
    const randExpr = document.getElementById('randExpr');
    const randInput = document.getElementById('randInput');
    const randStatus = document.getElementById('randStatus');
    const randAnsEl = document.getElementById('randAns');
    const randScoreEl = document.getElementById('randScore');
    const randBox = document.getElementById('randBox');

    let randB = 1;
    let randRight = A + randB;
    let randScore = 0;

    function randomInt(min, max){ return Math.floor(Math.random()*(max-min+1)) + min; }

    function nextRandomTask(){
      randB = randomInt(1,9);
      randRight = A + randB;
      randExpr.textContent = `${A} + ${randB} = ?`;
      randAnsEl.textContent = '—';
      randStatus.textContent = '➖';
      randStatus.className = 'status';
      randInput.value = '';
      randInput.style.borderColor = '#e5e7eb';
      randInput.focus();
    }

    function checkRandom(shakeOnFail=false){
      const raw = randInput.value.trim();
      if (raw === ''){
        randStatus.textContent = '➖';
        randStatus.className = 'status';
        randInput.style.borderColor = '#e5e7eb';
        return false;
      }
      const val = Number(raw);
      if (val === randRight){
        randStatus.textContent = '✓';
        randStatus.className = 'status ok';
        randInput.style.borderColor = 'var(--ok)';
        randScore += 1;
        randScoreEl.textContent = String(randScore);
        setTimeout(nextRandomTask, 600);
        return true;
      } else {
        randStatus.textContent = '✗';
        randStatus.className = 'status bad';
        randInput.style.borderColor = 'var(--bad)';
        if (shakeOnFail){
          randBox.classList.remove('shake'); void randBox.offsetWidth; randBox.classList.add('shake');
        }
        return false;
      }
    }

    document.getElementById('randCheck').addEventListener('click', ()=>checkRandom(true));
    document.getElementById('randSkip').addEventListener('click', nextRandomTask);
    document.getElementById('randShow').addEventListener('click', ()=>{
      randAnsEl.textContent = String(randRight);
    });
    randInput.addEventListener('keydown', (e)=>{ if (e.key === 'Enter') checkRandom(true); });

    // ==== Переключение режимов ====
    const modeAllBtn = document.getElementById('modeAllBtn');
    const modeRandBtn = document.getElementById('modeRandBtn');
    const toolbarAll = document.getElementById('toolbarAll');

    function switchMode(mode){ // 'all' | 'rand'
      const isAll = (mode === 'all');
      modeAllBtn.classList.toggle('active', isAll);
      modeRandBtn.classList.toggle('active', !isAll);
      grid.classList.toggle('hidden', !isAll);
      toolbarAll.classList.toggle('hidden', !isAll);
      randSection.classList.toggle('hidden', isAll);

      if (isAll){
        cards[0]?.querySelector('input')?.focus();
      } else {
        randScore = 0;
        randScoreEl.textContent = '0';
        nextRandomTask();
      }
    }

    modeAllBtn.addEventListener('click', ()=>switchMode('all'));
    modeRandBtn.addEventListener('click', ()=>switchMode('rand'));

    // ==== Реакция на смену A ====
    baseASelect.addEventListener('change', ()=>{
      A = Number(baseASelect.value);
      // перестраиваем «все примеры»
      renderAllCards();
      // обновляем рандомное выражение/ответ и сбрасываем счёт
      randScore = 0;
      randScoreEl.textContent = '0';
      if (!randSection.classList.contains('hidden')) nextRandomTask();
    });
  </script>
</body>
</html>
